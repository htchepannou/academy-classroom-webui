<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <meta charset="UTF-8" />

    <link rel="stylesheet" href='/static/lib/bootstrap/3.3.7/css/bootstrap.min.css"'/>
    <link rel="stylesheet" href='/static/lib/academy/css/academy.css"'/>

    <script src="/static/lib/jquery/3.2.1/js/jquery-3.2.1.min.js"></script>
    <script src="/static/lib/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<div class="playlist" th:fragment="playlist">
    <h4 th:text="${lesson.rank} + '. ' + ${lesson.title}">#</h4>
    <ul>
        <li th:each="item:${segments}" th:classappend="${item} == ${segment} ? active : ''">
            <div th:if="${item.attended}">
                <a th:attr="href='/classroom/' + ${course.id} + '/' + ${lesson.id} + '/' + ${item.id}">
                    <span class="ok"><i class="glyphicon glyphicon-ok"></i></span>
                    <span class="rank"  th:text="${item.rank}"></span>
                    <span class="title" th:text="${item.title}">Segment Title</span>
                </a>
            </div>
            <div th:if="!${item.attended}">
                <span class="ok"></span>
                <span class="rank"  th:text="${item.rank}"></span>
                <span class="title" th:text="${item.title}">Segment Title</span>
            </div>
        </li>
    </ul>
</div>

<div th:fragment="text">
    <div class="markdown" th:utext="${segment.description}">Description here...</div>
    <div class="pull-right">
        <a class="btn btn-primary" th:attr="href=${nextUrl}" th:text="#{button.continue}">...</a>
    </div>
</div>

<div th:fragment="video">
    <div class="embed-responsive embed-responsive-16by9">
        <div id="video-player" class="embed-responsive-item"></div>
    </div>
    <div class="markdown" th:utext="${segment.description}">Description here...</div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script th:inline="javascript">
        //<![CDATA[

        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player( 'video-player', {
                width: 750,
                height: 500,
                videoId: /*[[${video.videoId}]]*/ 'ID',
                events: {
                    'onReady': function(event){
                        console.log('onReady', event);
                        event.target.playVideo();
                    },
                    'onStateChange': function(event){
                        console.log('onStateChange', event);
                        var nextUrl = /*[[${nextUrl}]]*/ 'value';
                        if (nextUrl && event.data == YT.PlayerState.ENDED){
                            location.href = nextUrl;
                        }
                    }
                }
            });
        }
        //]]>
    </script>
</div>

<div th:fragment="quiz">
    <form id="quizform">
        <h3 class="quiz-question" th:text="${quiz.question}">Question Here</h3>
        <div class="markdown" th:utext="${quiz.description}">Description here...</div>

        <div class="quiz-answer">
            <ul th:if="${quiz.type} != 'singlechoice' || ${quiz.type} != 'multichoice'">
                <li th:each="choice:${quiz.choices}">
                    <input type="radio" name="value" th:if="${quiz.type} == 'singlechoice'" th:attr="value=${choice.id}"/>
                    <input type="checkbox" name="value" th:if="${quiz.type} == 'multichoice'"  th:attr="value=${choice.id}"/>

                    <span th:text="${choice.text}">Choice Text</span>
                </li>
            </ul>
            <input type="text" name="value" th:if="${quiz.type} == 'text'"/>
            <textarea name="value" th:if="${quiz.type} == 'longtext'"></textarea>
        </div>

        <div class="pull-right">
            <a class="btn btn-primary" th:text="#{button.submit_answer}" onclick="submit()">...</a>
        </div>
    </form>

    <!-- Success -->
    <div class="modal fade" id="modal_success" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" th:text="#{modal.quiz.success.title}"></h4>
                </div>
                <div class="modal-body"></div>
                </div>
                <div class="modal-footer">
                    <a type="button" class="btn btn-primary" th:text="#{button.continue}" th:attr="href=${nextUrl}"></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Failure -->
    <div class="modal fade" id="modal_failure" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" th:text="#{modal.quiz.failure.title}"></h4>
                </div>
                <div class="modal-body"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{button.try_again}"></button>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        //<![CDATA[
        function submit() {
            jQuery.ajax({
                type: 'POST',
                url: /*[['/classroom/' + ${course.id} + '/' + ${lesson.id} + '/' + ${segment.id} + '/quiz/submit']]*/ 'url',
                data: $('#quizform').serialize(),
                datatype: 'json',
                success: function (data){
                    console.log('result', data);
                    if (data.valid){
                        $('#modal_success .modal-body').text(data.message);
                        $('#modal_success').modal();
                    } else {
                        $('#modal_failure .modal-body').text(data.message);
                        $('#modal_failure').modal();
                    }
                }
            });
        }
        //]]>
    </script>
</div>

</body>
</html>
